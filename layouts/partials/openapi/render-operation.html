{{/*

  Render a single HTTP API operation: that is, a method+endpoint combination, given:

  * `method`: the method, e.g. GET, PUT
  * `endpoint`: the endpoint
  * `operation_data`: the OpenAPI/Swagger data for the operation
  * `path`: the path where this definition was found, to enable us to resolve "$ref"

  This template renders the operation as a `<section>` containing:

    * an `<h1>` heading containing the method and endpoint
    * a `<details>` element containing the details, including:
      * operation description
      * basic info about the operation
      * request details
      * response details

*/}}

{{ $method := .method }}
{{ $endpoint := .endpoint }}
{{ $operation_data := .operation_data }}
{{ $path := .path }}

<section class="rendered-data http-api {{ $method }}">

  <h1 id="{{ lower $method }}{{ anchorize $endpoint }}">
   <span class="http-api-method {{ $method }}">{{ $method }}</span>
   <span class="endpoint"><code>{{ $endpoint }}</code></span>
   {{ if $operation_data.deprecated }}<span class="deprecated-inline"></span>{{ end }}
  </h1>

  <hr/>

<details {{ if not site.Params.ui.rendered_data_collapsed }}open{{ end }}>
<summary>

{{ if $operation_data.deprecated }}
    {{ partial "alert" (dict "title" "Warning" "color" "warning" "content" "This API is deprecated and will be removed from a future release.") }}
{{ end }}

<p>{{ $operation_data.description | markdownify }}</p>

</summary>

<table class="basic-info">
  <tr>
   <th>Rate-limited:</th>
   {{ $forbidden := index $operation_data.responses "429" }}
   <td>{{ if $forbidden }}Yes{{ else }}No{{ end }}</td>
  </tr>
 <tr>
  <th>Requires authentication:</th>
  <td>{{ if $operation_data.security }}Yes{{ else }}No{{ end }}</td>
 </tr>
</table>

{{ partial "openapi/render-request"   (dict "parameters" $operation_data.parameters "path" $path) }}
{{ partial "openapi/render-responses" (dict "responses"  $operation_data.responses  "path" $path) }}

</details>

</section>
