{{ $event_name := .event_name }}
{{ $desired_example_name := .desired_example_name }}
{{ $event_data := .event_data }}
{{ $compact := .compact }}
{{ $base_data := .base_data }}

<section class="rendered-data event">

<details {{ if not $compact }}open{{ end }}>
<summary>

<h1 id="{{ anchorize $event_name }}">
 <code>{{ $event_name }}</code>
</h1>

<hr/>

{{ $event_data.description | markdownify }}

</summary>

{{ $state_key := index $event_data.properties "state_key" }}

<table class="basic-info">
  <tr>
   <th>Event type:</th>
   <td>{{ if $state_key }}State event{{ else }}Message event{{ end }}</td>
  </tr>
{{ if $state_key }}
  <tr>
   <th>State key</th>
   <td>{{ $state_key.description | markdownify }}</td>
 </tr>
{{ end }}
</table>

<h2>Content</h2>

{{ $additional_types := partial "openapi/resolvers/resolve-additional-types" $event_data.properties.content }}

{{ range $additional_types }}
    {{ partial "openapi/renderers/render-object-table" (dict "caption" .title "properties" .properties "required" .required) }}
{{end}}

<h2>Examples</h2>

{{ $all_examples := index $base_data "event-schemas" "examples" }}

{{ range $example_name, $example := $all_examples }}

    {{/* this is to allow the msgtype template to work */}}
    {{/* it lets callers specify exactly the name of the example they want */}}
    {{ if $desired_example_name }}
        {{ if eq $example_name $desired_example_name }}
            {{ $example_content := partial "openapi/resolvers/resolve-refs" (dict "schema" $example "path" "event-schemas/examples" "base_data" $base_data) }}
```json
{{ jsonify (dict "indent" "  ") $example_content }}
```
        {{ end }}
    {{/* if $desired_example_name is not given, we will include any */}}
    {{/* examples whose first part (before "$" matches the event name)*/}}
    {{ else }}

        {{ $pieces := split $example_name "$" }}
        {{ $example_base_name := index $pieces 0 }}
        {{ if eq $event_name $example_base_name }}
            {{ $example_content := partial "openapi/resolvers/resolve-refs" (dict "schema" $example "path" "event-schemas/examples" "base_data" $base_data) }}
```json
{{ jsonify (dict "indent" "  ") $example_content }}
```
        {{ end }}
    {{ end }}
{{ end }}

</section>
